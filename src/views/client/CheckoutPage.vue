<template>
  <div class="container-fluid py-3">
    <div class="row justify-content-center">
      <div class="col-12 col-xl-9">
        <!-- ƒê·ªãa ch·ªâ giao h√†ng -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">ƒê·ªãa ch·ªâ giao h√†ng</h6>
          </div>
          <div class="card-body py-3">
            <!-- ƒê·ªãa ch·ªâ ƒë·∫ßu ti√™n -->
            <div class="d-flex align-items-start mb-2 p-2 border rounded">
              <div class="form-check me-2 mt-1">
                <input
                  class="form-check-input"
                  type="radio"
                  name="address"
                  id="address1"
                  checked
                />
                <label class="form-check-label" for="address1"></label>
              </div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="small">
                    <strong>Vu Linh</strong> | ph·ªë 31 ƒë·ªìng da, Ph∆∞·ªùng B·∫øn Ngh√©,
                    Qu·∫≠n 1, H·ªì Ch√≠ Minh, VN | 0346447583
                  </div>
                  <button
                    class="btn btn-outline-primary btn-sm"
                    style="font-size: 11px; padding: 2px 8px"
                  >
                    S·ª≠a
                  </button>
                </div>
              </div>
            </div>

            <!-- ƒê·ªãa ch·ªâ th·ª© hai -->
            <div class="d-flex align-items-start mb-2 p-2 border rounded">
              <div class="form-check me-2 mt-1">
                <input
                  class="form-check-input"
                  type="radio"
                  name="address"
                  id="address2"
                />
                <label class="form-check-label" for="address2"></label>
              </div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="small">
                    <strong>linh vugk</strong> | ph·ªë 31 ƒë·ªìng da, Ph∆∞·ªùng B·∫°ch
                    Mai, Qu·∫≠n Hai B√† Tr∆∞ng, H√† N·ªôi, VN | 0989898990
                  </div>
                  <div>
                    <button
                      class="btn btn-outline-primary btn-sm me-1"
                      style="font-size: 11px; padding: 2px 8px"
                    >
                      S·ª≠a
                    </button>
                    <button
                      class="btn btn-outline-danger btn-sm"
                      style="font-size: 11px; padding: 2px 8px"
                    >
                      X√≥a
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ƒê·ªãa ch·ªâ th·ª© ba -->
            <div class="d-flex align-items-start mb-2 p-2 border rounded">
              <div class="form-check me-2 mt-1">
                <input
                  class="form-check-input"
                  type="radio"
                  name="address"
                  id="address3"
                />
                <label class="form-check-label" for="address3"></label>
              </div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="small">
                    <strong>linh vu</strong> | td, tggl, Appenzell Innerrhoden,
                    tr√∫, CH | 0989898990
                  </div>
                  <div>
                    <button
                      class="btn btn-outline-primary btn-sm me-1"
                      style="font-size: 11px; padding: 2px 8px"
                    >
                      S·ª≠a
                    </button>
                    <button
                      class="btn btn-outline-danger btn-sm"
                      style="font-size: 11px; padding: 2px 8px"
                    >
                      X√≥a
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Th√™m ƒë·ªãa ch·ªâ m·ªõi -->
            <div
              class="d-flex align-items-center p-2 border rounded border-dashed"
            >
              <div class="form-check me-2">
                <i class="fas fa-plus text-danger" style="font-size: 12px"></i>
              </div>
              <div>
                <button
                  class="btn btn-link text-danger p-0 text-decoration-none small"
                >
                  Giao h√†ng ƒë·∫øn ƒë·ªãa ch·ªâ kh√°c
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn</h6>
          </div>
          <div class="card-body py-3">
            <div class="d-flex align-items-center p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="shipping"
                  id="shipping1"
                  checked
                />
                <label class="form-check-label" for="shipping1"></label>
              </div>
              <div>
                <strong class="small">Giao h√†ng ti√™u chu·∫©n: 20.000 ƒë</strong>
                <div class="text-muted" style="font-size: 12px">
                  D·ª± ki·∫øn giao: Th·ª© T∆∞ - 02/07
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">Ph∆∞∆°ng th·ª©c thanh to√°n</h6>
          </div>
          <div class="card-body py-3">
            <!-- ZaloPay -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="zalopay"
                  checked
                />
                <label class="form-check-label" for="zalopay"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <img
                  src="https://stcd02206177151.cloud.edgevnpay.vn/assets/images/logo-icon/zalopay.png"
                  alt="ZaloPay"
                  class="me-2"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    padding: 3px;
                  "
                />
                <div>
                  <div class="small">
                    <strong>V√≠ ZaloPay</strong>
                    <span class="text-primary ms-1" style="font-size: 11px"
                      >Chi ti·∫øt</span
                    >
                  </div>
                  <div class="text-warning" style="font-size: 11px">
                    <strong
                      >Nh·∫≠p m√£: ZLPFHS - Gi·∫£m 20K cho ƒë∆°n h√†ng t·ª´ 300K</strong
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- VNPay -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="vnpay"
                />
                <label class="form-check-label" for="vnpay"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <img
                  src="https://vnpay.vn/s1/statics.vnpay.vn/2023/9/06ncktiwd6dc1694418196384.png"
                  alt="VNPay"
                  class="me-2"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    padding: 3px;
                  "
                />
                <div>
                  <div class="small">
                    <strong>VNPAY</strong>
                    <span class="text-primary ms-1" style="font-size: 11px"
                      >Chi ti·∫øt</span
                    >
                  </div>
                  <div class="text-warning" style="font-size: 11px">
                    <strong
                      >Nh·∫≠p m√£: VNPAYFHS - Gi·∫£m 40K cho ƒë∆°n h√†ng t·ª´ 200K</strong
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- ShopeePay -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="shopeepay"
                />
                <label class="form-check-label" for="shopeepay"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <img
                  src="https://down-vn.img.susercontent.com/file/d4bbea4570b93bfd5fc652ca82a262a8"
                  alt="ShopeePay"
                  class="me-2"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    padding: 3px;
                  "
                />
                <div>
                  <div class="small">
                    <strong>V√≠ ShopeePay</strong>
                    <span class="text-primary ms-1" style="font-size: 11px"
                      >Chi ti·∫øt</span
                    >
                  </div>
                  <div class="text-warning" style="font-size: 11px">
                    <strong
                      >Nh·∫≠p m√£: SPPFHS0725 - Gi·∫£m ngay 20K cho ƒë∆°n h√†ng t·ª´ 30K
                      tr√™n V√≠ ShopeePay</strong
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Momo -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="momo"
                />
                <label class="form-check-label" for="momo"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <img
                  src="https://developers.momo.vn/v3/assets/images/square-logo.svg"
                  alt="Momo"
                  class="me-2"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    padding: 3px;
                  "
                />
                <div>
                  <div class="small">
                    <strong>V√≠ Momo</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- ATM / Internet Banking -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="atm"
                />
                <label class="form-check-label" for="atm"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <div
                  class="me-2 d-flex align-items-center justify-content-center"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    background-color: #f8f9fa;
                  "
                >
                  <i
                    class="fas fa-university"
                    style="font-size: 14px; color: #6c757d"
                  ></i>
                </div>
                <div>
                  <div class="small">
                    <strong>ATM / Internet Banking</strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Visa / Master / JCB -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="visa"
                />
                <label class="form-check-label" for="visa"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <div
                  class="me-2 d-flex align-items-center justify-content-center"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    background-color: #f8f9fa;
                  "
                >
                  <i
                    class="fas fa-credit-card"
                    style="font-size: 14px; color: #6c757d"
                  ></i>
                </div>
                <div>
                  <div class="small">
                    <strong>Visa / Master / JCB</strong>
                    <span class="text-primary ms-1" style="font-size: 11px"
                      >Chi ti·∫øt</span
                    >
                  </div>
                  <div class="text-warning" style="font-size: 11px">
                    <strong
                      >Nh·∫≠p m√£: VPBFHS50K - Gi·∫£m Ngay 50K cho ƒêH t·ª´ 400K khi
                      thanh to√°n b·∫±ng th·∫ª t√≠n d·ª•ng VPBank</strong
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng -->
            <div class="d-flex align-items-center mb-2 p-2 border rounded">
              <div class="form-check me-2">
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="cod"
                />
                <label class="form-check-label" for="cod"></label>
              </div>
              <div class="d-flex align-items-center flex-grow-1">
                <div
                  class="me-2 d-flex align-items-center justify-content-center"
                  style="
                    width: 30px;
                    height: 30px;
                    border: 1px solid #ddd;
                    border-radius: 3px;
                    background-color: #f8f9fa;
                  "
                >
                  <i
                    class="fas fa-money-bill-wave"
                    style="font-size: 14px; color: #6c757d"
                  ></i>
                </div>
                <div>
                  <div class="small">
                    <strong>Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Th√†nh vi√™n BookStation -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold text-primary">
              Th√†nh vi√™n BookStation
            </h6>
          </div>
          <div class="card-body py-3">
            <!-- B-Point -->
            <div class="mb-3">
              <div
                class="d-flex align-items-center justify-content-between mb-2"
              >
                <div class="small">
                  <strong>S·ªë B-Point hi·ªán c√≥:</strong>
                  <span class="text-warning ms-1">0</span>
                </div>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="usePoints"
                />
                <label class="form-check-label small" for="usePoints">
                  S·ª≠ d·ª•ng B-point ƒë·ªÉ thanh to√°n
                </label>
              </div>
            </div>

            <!-- Freeship -->
            <div class="mb-3">
              <div
                class="d-flex align-items-center justify-content-between mb-2"
              >
                <div class="small">
                  <strong>S·ªë l·∫ßn freeship:</strong>
                  <span class="text-warning ms-1">0 l·∫ßn</span>
                </div>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="useFreeship"
                />
                <label class="form-check-label small" for="useFreeship">
                  S·ª≠ d·ª•ng freeship
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- M√£ khuy·∫øn m√£i/M√£ qu√† t·∫∑ng -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">
              M√£ khuy·∫øn m√£i/M√£ qu√† t·∫∑ng
            </h6>
          </div>
          <div class="card-body py-3">
            <div class="row">
              <div class="col-8">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  placeholder="Nh·∫≠p m√£ khuy·∫øn m√£i/Qu√† t·∫∑ng"
                  v-model="couponCode"
                  style="font-size: 14px"
                />
              </div>
              <div class="col-4">
                <button
                  class="btn btn-primary btn-sm w-100"
                  @click="applyCoupon"
                  style="font-size: 14px"
                >
                  √Åp d·ª•ng
                </button>
              </div>
            </div>
            <div class="mt-2">
              <button
                class="btn btn-link p-0 text-primary text-decoration-none small"
                @click="showVoucherList = true"
              >
                Ch·ªçn m√£ khuy·∫øn m√£i
              </button>
            </div>
            <!-- Modal ch·ªçn voucher -->
            <div v-if="showVoucherList" class="voucher-modal-overlay">
              <div class="voucher-modal card shadow p-3">
                <div class="d-flex align-items-center mb-3">
                  <span class="fw-bold text-primary me-2"
                    ><i class="fas fa-ticket-alt"></i> CH·ªåN M√É KHUY·∫æN M√ÉI</span
                  >
                  <span class="small text-muted"
                    >C√≥ th·ªÉ √°p d·ª•ng ƒë·ªìng th·ªùi nhi·ªÅu m√£</span
                  >
                  <button
                    class="btn btn-sm btn-outline-secondary ms-auto"
                    @click="showVoucherList = false"
                  >
                    ƒê√≥ng
                  </button>
                </div>
                <input
                  type="text"
                  class="form-control form-control-sm mb-2"
                  v-model="voucherSearch"
                  placeholder="T√¨m ki·∫øm m√£..."
                />
                <div v-if="filteredVouchers.length > 0">
                  <div
                    v-for="voucher in filteredVouchers"
                    :key="voucher.id || voucher.code"
                    class="voucher-item border rounded p-2 mb-2 d-flex align-items-center justify-content-between"
                    :style="{
                      background: selectedVouchers.some(
                        (v) => v.code === voucher.code
                      )
                        ? '#e3f2fd'
                        : '#fff',
                    }"
                  >
                    <div>
                      <div class="fw-bold">
                        {{ voucher.name || voucher.code }}
                      </div>
                      <div class="small text-muted">
                        {{ voucher.description }}
                      </div>
                      <div class="small">
                        HSD:
                        {{
                          new Date(voucher.endTime).toLocaleDateString("vi-VN")
                        }}
                      </div>
                    </div>
                    <button
                      class="btn btn-sm"
                      :class="
                        selectedVouchers.some((v) => v.code === voucher.code)
                          ? 'btn-danger'
                          : 'btn-primary'
                      "
                      @click="toggleVoucher(voucher)"
                    >
                      {{
                        selectedVouchers.some((v) => v.code === voucher.code)
                          ? "B·ªè ch·ªçn"
                          : "Ch·ªçn"
                      }}
                    </button>
                  </div>
                </div>
                <div v-else class="text-muted small">
                  Kh√¥ng t√¨m th·∫•y m√£ ph√π h·ª£p
                </div>
                <div class="mt-3 text-end">
                  <button
                    class="btn btn-primary"
                    @click="showVoucherList = false"
                  >
                    √Åp d·ª•ng
                  </button>
                </div>
              </div>
            </div>
            <!-- Hi·ªÉn th·ªã list voucher ƒë√£ ch·ªçn -->
            <div v-if="selectedVouchers.length > 0" class="mt-2">
              <div class="fw-bold small mb-1">Voucher ƒë√£ ch·ªçn:</div>
              <div class="d-flex flex-wrap gap-2">
                <span
                  v-for="voucher in selectedVouchers"
                  :key="voucher.code"
                  class="badge bg-primary text-white d-flex align-items-center"
                >
                  {{ voucher.code }}
                  <button
                    class="btn btn-sm btn-link text-white ms-1 p-0"
                    style="font-size: 13px"
                    @click="toggleVoucher(voucher)"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </span>
              </div>
            </div>
            <div class="text-muted small mt-1">
              C√≥ th·ªÉ √°p d·ª•ng ƒë·ªìng th·ªùi nhi·ªÅu m√£
            </div>

            <!-- Nh·∫≠n qu√† section -->
            <div
              class="mt-3 p-2"
              style="background-color: #f8f9fa; border-radius: 6px"
            >
              <div class="d-flex align-items-center">
                <i class="fas fa-gift text-primary me-2"></i>
                <div class="flex-grow-1">
                  <div class="small fw-bold text-primary">Nh·∫≠n qu√†</div>
                  <div class="text-muted" style="font-size: 12px">
                    ƒê∆°n h√†ng c·ªßa b·∫°n ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán nh·∫≠n qu√†
                  </div>
                </div>
                <button
                  class="btn btn-outline-primary btn-sm"
                  @click="selectGift"
                >
                  <span style="font-size: 12px">Ch·ªçn qu√†</span>
                  <i
                    class="fas fa-chevron-right ms-1"
                    style="font-size: 10px"
                  ></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Th√¥ng tin kh√°c -->
        <div class="card mb-3">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">Th√¥ng tin kh√°c</h6>
          </div>
          <div class="card-body py-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="note" />
              <label class="form-check-label small" for="note"> Ghi ch√∫ </label>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="invoice" />
              <label class="form-check-label small" for="invoice">
                Xu·∫•t h√≥a ƒë∆°n GTGT
                <span class="text-primary ms-1" style="font-size: 11px"
                  >Chi ti·∫øt</span
                >
              </label>
            </div>
            <div class="text-danger small">
              *T·ª´ ng√†y 01/11/2020, C√¥ng ty BookStation kh√¥ng gi·∫£i quy·∫øt vi·ªác
              xu·∫•t l·∫°i h√≥a ƒë∆°n cho c√°c tr∆∞·ªùng h·ª£p Qu√Ω kh√°ch kh√¥ng ƒëƒÉng k√Ω th√¥ng
              tin
            </div>
          </div>
        </div>

        <!-- Ki·ªÉm tra l·∫°i ƒë∆°n h√†ng -->
        <div class="card mb-5">
          <div class="card-header bg-white py-2">
            <h6 class="mb-0 text-uppercase fw-bold">Ki·ªÉm tra l·∫°i ƒë∆°n h√†ng</h6>
          </div>
          <div class="card-body py-3">
            <div class="d-flex align-items-start">
              <img
                src="/src/assets/img/login/frontImg.jpg"
                alt="Product"
                class="me-3"
                style="
                  width: 80px;
                  height: 100px;
                  object-fit: cover;
                  border-radius: 4px;
                "
              />
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="small flex-grow-1 me-3" style="line-height: 1.4">
                    <strong
                      >B√∫p Sen Xanh - B√¨a C·ª©ng - T·∫∑ng K√®m Obi + Postcard H√†nh
                      Tr√¨nh C·ª©u N∆∞·ªõc - ƒê·ªôc Quy·ªÅn BookStation</strong
                    >
                  </div>
                  <div class="small text-muted text-nowrap me-3">110.000 ƒë</div>
                  <div class="small text-muted text-nowrap me-3">1</div>
                  <div class="small fw-bold text-nowrap">110.000 ƒë</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ƒê·ªìng √Ω ƒëi·ªÅu kho·∫£n -->
        <!-- ƒê√£ chuy·ªÉn xu·ªëng thanh d∆∞·ªõi -->
      </div>
    </div>

    <!-- Thanh t·ªïng ti·ªÅn c·ªë ƒë·ªãnh ·ªü d∆∞·ªõi -->
    <div class="fixed-bottom bg-white border-top shadow-lg">
      <div class="container-fluid py-3">
        <!-- Ph·∫ßn t·ªïng ti·ªÅn ·ªü tr√™n -->
        <div class="row justify-content-end mb-2">
          <div class="col-auto">
            <div class="text-end">
              <div
                class="d-flex justify-content-between align-items-center mb-1"
              >
                <span class="small text-muted me-3">Th√†nh ti·ªÅn</span>
                <span class="fw-bold small">110.000 ƒë</span>
              </div>
              <div
                class="d-flex justify-content-between align-items-center mb-1"
              >
                <span class="small text-muted me-3"
                  >Ph√≠ v·∫≠n chuy·ªÉn (Giao h√†ng ti√™u chu·∫©n)</span
                >
                <span class="fw-bold small">20.000 ƒë</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="small text-muted me-3"
                  >T·ªïng S·ªë Ti·ªÅn (g·ªìm VAT)</span
                >
                <span class="fw-bold text-warning">130.000 ƒë</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ƒê∆∞·ªùng k·∫ª ngƒÉn c√°ch -->
        <hr class="my-2" style="border-color: #dee2e6" />

        <!-- Ph·∫ßn ƒëi·ªÅu kho·∫£n v√† n√∫t thanh to√°n ·ªü d∆∞·ªõi -->
        <div class="row align-items-center">
          <div class="col-12 col-md-6">
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="agree"
                checked
              />
              <label class="form-check-label small" for="agree">
                B·∫±ng vi·ªác ti·∫øn h√†nh Mua h√†ng, b·∫°n ƒë√£ ƒë·ªìng √Ω v·ªõi
                <a href="#" class="text-primary"
                  >ƒêi·ªÅu kho·∫£n & ƒêi·ªÅu ki·ªán c·ªßa BookStation.com</a
                >
              </label>
            </div>
          </div>
          <div class="col-12 col-md-6 text-center text-md-end">
            <button
              class="btn btn-danger px-4 py-2 fw-bold"
              @click="processPayment"
            >
              X√°c nh·∫≠n thanh to√°n
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Padding ƒë·ªÉ tr√°nh b·ªã che b·ªüi thanh c·ªë ƒë·ªãnh -->
    <div style="height: 120px"></div>

    <!-- Modal ch·ªçn m√£ khuy·∫øn m√£i -->
    <div
      class="modal fade"
      id="couponModal"
      tabindex="-1"
      aria-labelledby="couponModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="couponModalLabel">
              Ch·ªçn m√£ khuy·∫øn m√£i
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- T√¨m ki·∫øm v√† l·ªçc voucher -->
            <div class="mb-3">
              <input
                type="text"
                class="form-control form-control-sm"
                placeholder="T√¨m ki·∫øm m√£ khuy·∫øn m√£i"
                v-model="voucherSearch"
                style="font-size: 14px"
              />
            </div>

            <!-- Danh s√°ch voucher -->
            <div v-if="voucherLoading" class="text-center py-3">
              <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            <div v-else>
              <div
                v-if="filteredVouchers.length === 0"
                class="text-center py-3 text-muted"
              >
                Kh√¥ng c√≥ m√£ khuy·∫øn m√£i n√†o ph√π h·ª£p
              </div>
              <div v-else>
                <div
                  v-for="voucher in filteredVouchers"
                  :key="voucher.id"
                  class="d-flex align-items-center py-2 border-bottom"
                >
                  <div class="form-check me-2">
                    <input
                      class="form-check-input"
                      type="radio"
                      :id="'voucher' + voucher.id"
                      name="voucher"
                      :value="voucher.code"
                      v-model="selectedVouchers"
                    />
                    <label
                      class="form-check-label"
                      :for="'voucher' + voucher.id"
                    >
                      <div class="small">
                        <strong>{{ voucher.name }}</strong>
                        <span class="text-muted" style="font-size: 12px"
                          >({{ voucher.code }})</span
                        >
                      </div>
                      <div class="text-warning" style="font-size: 12px">
                        Gi·∫£m {{ voucher.discount }} ƒë
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ƒê√≥ng
            </button>
            <button
              type="button"
              class="btn btn-primary"
              @click="applySelectedVouchers"
            >
              √Åp d·ª•ng m√£ ƒë√£ ch·ªçn
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { getUserVoucher } from "@/services/client/userVoucher";
import { getUserId } from "@/utils/utils";
const voucherChannel = new BroadcastChannel("voucher-status");
export default {
  name: "CheckoutPage",
  data() {
    return {
      couponCode: "",
      showVoucherList: false,
      voucherSearch: "",
      userVouchers: [],
      selectedVouchers: [],
      voucherLoading: false,
      selectedAddress: "address1",
      selectedShipping: "shipping1",
      selectedPayment: "zalopay",
      agreed: true,
      usePoints: false,
      useFreeship: false,
      addNote: false,
      needInvoice: false,
      fPoints: 0,
      freeshipCount: 0,
    };
  },
  computed: {
    filteredVouchers() {
      if (!this.voucherSearch.trim()) return this.userVouchers;
      return this.userVouchers.filter(
        (v) =>
          (v.code &&
            v.code.toLowerCase().includes(this.voucherSearch.toLowerCase())) ||
          (v.name &&
            v.name.toLowerCase().includes(this.voucherSearch.toLowerCase()))
      );
    },
  },
  mounted() {
    voucherChannel.onmessage = (event) => {
      if (event.data === "updated") {
        this.loadUserVouchers();
        console.log(
          "CheckoutPage.vue: ƒê√£ nh·∫≠n s·ª± ki·ªán voucher-status-updated qua BroadcastChannel"
        );
      }
    };
  },
  beforeUnmount() {
    voucherChannel.close();
  },
  methods: {
    applyCoupon() {
      if (this.couponCode.trim()) {
        // X·ª≠ l√Ω √°p d·ª•ng m√£ gi·∫£m gi√°
        alert("M√£ gi·∫£m gi√° ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng!");
      }
    },
    selectCoupon() {
      // M·ªü modal ch·ªçn m√£ khuy·∫øn m√£i
      alert("Ch·ªçn m√£ khuy·∫øn m√£i");
    },
    selectGift() {
      // M·ªü modal ch·ªçn qu√†
      alert("Ch·ªçn qu√† t·∫∑ng");
    },
    processPayment() {
      if (!this.agreed) {
        alert("Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n v√† ƒëi·ªÅu ki·ªán!");
        return;
      }

      // X·ª≠ l√Ω thanh to√°n
      alert("ƒêang x·ª≠ l√Ω thanh to√°n...");
      // Redirect ho·∫∑c g·ªçi API thanh to√°n ·ªü ƒë√¢y
    },
    async loadUserVouchers() {
      try {
        this.voucherLoading = true;
        const res = await getUserVoucher(getUserId());
        const allVouchers = Array.isArray(res.data)
          ? res.data
          : res.data.data || [];

        // üëâ L·ªçc nh·ªØng voucher c√≥ status === 1
        this.userVouchers = allVouchers.filter((v) => v.status === 1);
      } catch (e) {
        this.userVouchers = [];
      } finally {
        this.voucherLoading = false;
      }
    },

    isVoucherExpired(voucher) {
      return Date.now() > voucher.endTime;
    },
    isVoucherActive(voucher) {
      return (
        voucher.status === 1 &&
        !this.isVoucherExpired(voucher) &&
        voucher.usageLimit > voucher.usedCount
      );
    },
    canUseVoucher(voucher) {
      return this.totalAmount >= voucher.minOrderValue;
    },
    applySelectedVouchers() {
      // √Åp d·ª•ng c√°c voucher ƒë√£ ch·ªçn
      const appliedVouchers = this.selectedVouchers.filter((v) => v);
      if (appliedVouchers.length > 0) {
        alert("ƒê√£ √°p d·ª•ng c√°c m√£: " + appliedVouchers.join(", "));
      } else {
        alert("Ch∆∞a c√≥ m√£ khuy·∫øn m√£i n√†o ƒë∆∞·ª£c ch·ªçn");
      }
    },
    toggleVoucher(voucher) {
      const idx = this.selectedVouchers.findIndex(
        (v) => v.code === voucher.code
      );
      if (idx > -1) {
        this.selectedVouchers.splice(idx, 1);
      } else {
        this.selectedVouchers.push(voucher);
      }
    },
  },
  beforeUnmount() {
    voucherChannel.close();
  },
};
</script>

<style scoped>
.card {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.card-header {
  border-bottom: 1px solid #e0e0e0;
  padding: 1rem 1.5rem;
}

.form-check-input:checked {
  background-color: #dc3545;
  border-color: #dc3545;
}

.btn-danger {
  background-color: #dc3545;
  border-color: #dc3545;
}

.btn-danger:hover {
  background-color: #c82333;
  border-color: #bd2130;
}

.text-warning {
  color: #ffc107 !important;
}

/* Fixed bottom bar */
.fixed-bottom {
  z-index: 1030;
}

/* Border dashed style */
.border-dashed {
  border-style: dashed !important;
  border-color: #dc3545 !important;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .container-fluid {
    padding: 0.5rem;
  }

  .card-body {
    padding: 0.5rem;
  }

  .fixed-bottom .row:first-child {
    flex-direction: column;
    align-items: center;
  }

  .fixed-bottom .row:last-child {
    flex-direction: column;
  }

  .fixed-bottom .col-md-6:first-child {
    margin-bottom: 0.5rem;
  }

  .fixed-bottom {
    padding: 0.75rem 0;
  }

  .fixed-bottom .d-flex {
    flex-direction: column;
    gap: 0.5rem;
  }
}

/* Hover effects */
.border:hover {
  border-color: #dc3545 !important;
  box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

/* Additional styles */
.text-primary {
  color: #007bff !important;
}

.btn-primary {
  background-color: #007bff;
  border-color: #007bff;
}

.btn-primary:hover {
  background-color: #0056b3;
  border-color: #004085;
}

.btn-outline-primary {
  color: #007bff;
  border-color: #007bff;
}

.btn-outline-primary:hover {
  background-color: #007bff;
  border-color: #007bff;
  color: #fff;
}

/* Gift section styling */
.fas.fa-gift {
  font-size: 16px;
}

/* Product image styling */
.card-body img {
  border: 1px solid #e0e0e0;
}

/* Form control styling */
.form-control-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.875rem;
  border-radius: 0.375rem;
}

/* Icon styling for payment methods */
.fas.fa-university,
.fas.fa-credit-card,
.fas.fa-money-bill-wave {
  color: #6c757d;
}

/* Checkbox styling */
.form-check-input {
  margin-top: 0.25rem;
}

/* Card header with primary color */
.card-header h6.text-primary {
  color: #007bff !important;
}

/* Voucher modal styling */
.voucher-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.2);
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.voucher-modal {
  max-width: 500px;
  width: 100%;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
}

.voucher-item {
  transition: background 0.2s;
}

.voucher-item:hover {
  background: #f1f8ff;
}
</style>
